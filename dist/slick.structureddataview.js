/**
 * http://github.com/keik/slick-structured-dataview
 * @license MIT
 */
"use strict";var DEV=false;(function($){"use strict";$.extend(true,window,{Slick:{Data:{StructuredDataView:StructuredDataView},Extractor:{structuredDataExtractor:structuredDataExtractor}}});function StructuredDataView(){var _items=[];var _rows=[];var onRowCountChanged=new Slick.Event,onRowsChanged=new Slick.Event;function getLength(){return _rows.length}function getItem(i){return _rows[i]}function getItemMetadata(){return{}}function setItems(items){_items=items;_rows=_genRowsFromItems(_items);if(DEV)console.log("RESULT:",JSON.stringify(_rows));if(DEV)console.log("============================");_refresh()}function getItems(){return _items}function _refresh(){onRowsChanged.notify();onRowCountChanged.notify()}function _genRowsFromItems(item){var acc=arguments.length<=1||arguments[1]===undefined?[]:arguments[1];var isObjInObj=arguments.length<=2||arguments[2]===undefined?false:arguments[2];var isFirstChild=arguments.length<=3||arguments[3]===undefined?false:arguments[3];if(DEV)console.log("called:",item,isObjInObj?"isObjInObj":"",isFirstChild?"isFirstChild":"");var i,len;if($.isArray(item)){var parent=acc.length-1;for(i=0,len=item.length;i<len;i++){_genRowsFromItems(item[i],acc,false,i===0,parent)}}else{var hasArray=false;if(acc.length===0||!isObjInObj&&!isFirstChild){if(DEV)console.log("push  :",JSON.stringify(item)+" to "+JSON.stringify(acc));acc.push(item)}for(var key in item){if(item.hasOwnProperty(key)){var val=item[key];if($.isArray(val)){if(hasArray){throw new TypeError("Arguments cannot have multiple children at same depth: `"+hasArray+"` and `"+key+"`")}else{hasArray=key}_genRowsFromItems(val,acc,false)}else if(typeof val==="object")_genRowsFromItems(val,acc,true)}}}return acc}function _getRowspan(row,col){var item=_rows[row];function _findRoot(_x4,_x5){var _again=true;_function:while(_again){var item=_x4,col=_x5;target=key=val=undefined;_again=false;var target=item[col];if(target==null){for(var key in item){if(item.hasOwnProperty(key)){var val=item[key];if(typeof val==="object"){_x4=val;_x5=col;_again=true;continue _function}}}}else{return item}return null}}function _getGeneration(item){if(item==null){return null}var depth=0;_dive(item);function _dive(item){var hasArrayOrObj=false;if(typeof item!=="object")return;for(var key in item){if(item.hasOwnProperty(key)){var val=item[key];if(typeof val==="object"){hasArrayOrObj=true;if($.isArray(val)){for(var i=0,len=val.length;i<len;i++){_dive(val[i])}}else{_dive(val)}}}}if(!hasArrayOrObj){depth++}}return depth}return _getGeneration(_findRoot(item,col))}function syncGridCellCssStyles(grid,key){function _createCssRules(grid){function _measureVCellPaddingAndBorder(){var v=["borderTopWidth","borderBottomWidth","paddingTop","paddingBottom"],$canvas=$(grid.getCanvasNode()),$r=$('<div class="slick-row" />').appendTo($canvas),$el=$('<div class="slick-cell" id="" style="visibility:hidden">-</div>').appendTo($r);var height,heightDiff=0;height=parseFloat($el.css("height"));$.each(v,function(n,val){heightDiff+=parseFloat($el.css(val))||0});$r.remove();return{height:height,heightDiff:heightDiff}}var uid=grid.getContainerNode().className.match(/(?: |^)slickgrid_\d+(?!\w)/)[0],v=_measureVCellPaddingAndBorder();var rules=[".hidden {visibility: hidden;}"];var maxrow=30;for(var i=0;i<maxrow;i++){rules.push("."+uid+" .h"+i+" {height:"+(i*(v.height+v.heightDiff)-v.heightDiff)+"px;}")}var styleEl=$('<style type="text/css" rel="stylesheet" />').appendTo($("head"))[0];if(styleEl.styleSheet){styleEl.styleSheet.cssText=rules.join(" ")}else{styleEl.appendChild(document.createTextNode(rules.join(" ")))}}function update(){var cssHash=_genCssHashFromRows(_rows,grid.getColumns());grid.setCellCssStyles(key,cssHash)}this.onRowsChanged.subscribe(update);this.onRowCountChanged.subscribe(update);_createCssRules(grid);update()}function _genCssHashFromRows(rows,columns){var cssHash={};for(var i=0,I=rows.length;i<I;i++){for(var j=0,J=columns.length;j<J;j++){cssHash[i]=cssHash[i]||{};var columnId=columns[j].id;var rowspan=_getRowspan(i,columnId);cssHash[i][columnId]=rowspan!=null?"h"+rowspan:"hidden"}}return cssHash}$.extend(this,{getLength:getLength,getItem:getItem,getItemMetadata:getItemMetadata,setItems:setItems,getItems:getItems,syncGridCellCssStyles:syncGridCellCssStyles,onRowsChanged:onRowsChanged,onRowCountChanged:onRowCountChanged})}function structuredDataExtractor(item,columnDef){function findValue(_x6,_x7){var _again2=true;_function2:while(_again2){var item=_x6,columnDef=_x7;v=key=nested=undefined;_again2=false;var v=item[columnDef.field];if(v==null){for(var key in item){if(item.hasOwnProperty(key)){var nested=item[key];if(typeof nested==="object"){_x6=nested;_x7=columnDef;_again2=true;continue _function2}}}}else if(typeof v==="object"){return item}return v!=null?v:""}}return String(findValue(item,columnDef))}})(jQuery);